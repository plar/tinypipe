============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /home/runner/work/justpipe/justpipe
configfile: pyproject.toml
testpaths: tests
plugins: cov-7.0.0, asyncio-1.3.0, anyio-4.12.1, repeat-0.9.4
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 176 items

tests/functional/test_advanced_flow.py .........                         [  5%]
tests/functional/test_backpressure.py ..                                 [  6%]
tests/functional/test_barrier_timeout.py ..                              [  7%]
tests/functional/test_edge_cases.py .......                              [ 11%]
tests/functional/test_error_handling.py ...........                      [ 17%]
tests/functional/test_examples_execution.py ...........                  [ 23%]
tests/functional/test_examples_utils.py ....                             [ 26%]
tests/functional/test_execution.py .....................                 [ 38%]
tests/functional/test_middleware.py .........                            [ 43%]
tests/functional/test_registration.py .....                              [ 46%]
tests/functional/test_shutdown.py ..                                     [ 47%]
tests/functional/test_visualization.py ............                      [ 53%]
tests/integration/test_acceptance.py .                                   [ 54%]
tests/unit/test_core_utils.py .........                                  [ 59%]
tests/unit/test_event_hooks.py .....                                     [ 62%]
tests/unit/test_injection_validation.py .....                            [ 65%]
tests/unit/test_introspection.py ............                            [ 72%]
tests/unit/test_structures.py .....                                      [ 75%]
tests/unit/test_topology_callable.py ..................                  [ 85%]
tests/unit/test_visual_ast.py ..........................                 [100%]

=============================== warnings summary ===============================
tests/functional/test_advanced_flow.py::test_dag_barrier_multiple_paths
tests/functional/test_edge_cases.py::test_concurrent_token_streaming
tests/functional/test_registration.py::test_step_decorator_variations
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('a') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_advanced_flow.py::test_dag_barrier_multiple_paths
tests/functional/test_edge_cases.py::test_concurrent_token_streaming
tests/functional/test_registration.py::test_step_decorator_variations
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('b') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_advanced_flow.py::test_dag_barrier_multiple_paths
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:24: DeprecationWarning: String-based topology ('c') is deprecated. Use direct function references instead.
    @pipe.step("a", to="c")

tests/functional/test_advanced_flow.py::test_dag_barrier_multiple_paths
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:28: DeprecationWarning: String-based topology ('d') is deprecated. Use direct function references instead.
    @pipe.step("b", to="d")

tests/functional/test_advanced_flow.py::test_dag_barrier_multiple_paths
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:32: DeprecationWarning: String-based topology ('c') is deprecated. Use direct function references instead.
    @pipe.step("d", to="c")

tests/functional/test_advanced_flow.py::test_map_parallelism
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:54: DeprecationWarning: String-based topology ('worker') is deprecated. Use direct function references instead.
    @pipe.map("start", using="worker", to="end")

tests/functional/test_advanced_flow.py::test_map_parallelism
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:54: DeprecationWarning: String-based topology ('end') is deprecated. Use direct function references instead.
    @pipe.map("start", using="worker", to="end")

tests/functional/test_advanced_flow.py::test_suspend_execution
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:106: DeprecationWarning: String-based topology ('next_step') is deprecated. Use direct function references instead.
    @pipe.step("start", to="next_step")

tests/functional/test_advanced_flow.py::test_map_empty_list
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:151: DeprecationWarning: String-based topology ('worker') is deprecated. Use direct function references instead.
    @pipe.map("start", using="worker")

tests/functional/test_advanced_flow.py::test_map_no_unknown_args
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:172: DeprecationWarning: String-based topology ('worker') is deprecated. Use direct function references instead.
    @pipe.map("start", using="worker")

tests/functional/test_advanced_flow.py::test_map_multiple_unknown_args
  /home/runner/work/justpipe/justpipe/tests/functional/test_advanced_flow.py:193: DeprecationWarning: String-based topology ('worker') is deprecated. Use direct function references instead.
    @pipe.map("start", using="worker")

tests/functional/test_backpressure.py::test_backpressure_with_next_steps
  /home/runner/work/justpipe/justpipe/tests/functional/test_backpressure.py:86: DeprecationWarning: String-based topology ('step_b') is deprecated. Use direct function references instead.
    @pipe.step(to="step_b")

tests/functional/test_barrier_timeout.py::test_barrier_timeout_success
  /home/runner/work/justpipe/justpipe/tests/functional/test_barrier_timeout.py:11: DeprecationWarning: String-based topology ('combine') is deprecated. Use direct function references instead.
    @pipe.step(to="combine")

tests/functional/test_barrier_timeout.py::test_barrier_timeout_success
  /home/runner/work/justpipe/justpipe/tests/functional/test_barrier_timeout.py:15: DeprecationWarning: String-based topology ('combine') is deprecated. Use direct function references instead.
    @pipe.step(to="combine")

tests/functional/test_barrier_timeout.py::test_barrier_timeout_failure
  /home/runner/work/justpipe/justpipe/tests/functional/test_barrier_timeout.py:34: DeprecationWarning: String-based topology ('combine') is deprecated. Use direct function references instead.
    @pipe.step(to="combine")

tests/functional/test_barrier_timeout.py::test_barrier_timeout_failure
  /home/runner/work/justpipe/justpipe/tests/functional/test_barrier_timeout.py:38: DeprecationWarning: String-based topology ('combine') is deprecated. Use direct function references instead.
    @pipe.step(to="combine")

tests/functional/test_error_handling.py::test_step_level_substitution
  /home/runner/work/justpipe/justpipe/tests/functional/test_error_handling.py:15: DeprecationWarning: String-based topology ('next_step') is deprecated. Use direct function references instead.
    @pipe.step(on_error=handle_error, to="next_step")

tests/functional/test_error_handling.py::test_skip_pruning
  /home/runner/work/justpipe/justpipe/tests/functional/test_error_handling.py:80: DeprecationWarning: String-based topology ('dependent') is deprecated. Use direct function references instead.
    @pipe.step(on_error=lambda e: Skip(), to="dependent")

tests/functional/test_execution.py::test_linear_execution_flow
  /home/runner/work/justpipe/justpipe/tests/functional/test_execution.py:13: DeprecationWarning: String-based topology ('step2') is deprecated. Use direct function references instead.
    @pipe.step("start", to="step2")

tests/functional/test_execution.py::test_declarative_switch
  /home/runner/work/justpipe/justpipe/justpipe/core.py:770: DeprecationWarning: String-based topology ('step_a') is deprecated. Use direct function references instead.
    self._validate_routing_target(routes)

tests/functional/test_execution.py::test_declarative_switch
  /home/runner/work/justpipe/justpipe/justpipe/core.py:770: DeprecationWarning: String-based topology ('step_b') is deprecated. Use direct function references instead.
    self._validate_routing_target(routes)

tests/functional/test_execution.py::test_step_not_found
  /home/runner/work/justpipe/justpipe/tests/functional/test_execution.py:157: DeprecationWarning: String-based topology ('non_existent') is deprecated. Use direct function references instead.
    @pipe.step("start", to="non_existent")

tests/functional/test_execution.py::test_switch_no_match_no_default
  /home/runner/work/justpipe/justpipe/justpipe/core.py:770: DeprecationWarning: String-based topology ('y') is deprecated. Use direct function references instead.
    self._validate_routing_target(routes)

tests/functional/test_registration.py::test_step_registration_basics
  /home/runner/work/justpipe/justpipe/tests/functional/test_registration.py:17: DeprecationWarning: String-based topology ('next_step') is deprecated. Use direct function references instead.
    @pipe.step("start", to="next_step")

tests/functional/test_registration.py::test_step_decorator_variations
  /home/runner/work/justpipe/justpipe/tests/functional/test_registration.py:32: DeprecationWarning: String-based topology ('explicit') is deprecated. Use direct function references instead.
    @pipe.step(to="explicit")

tests/functional/test_visualization.py::test_linear_graph
  /home/runner/work/justpipe/justpipe/tests/functional/test_visualization.py:14: DeprecationWarning: String-based topology ('b') is deprecated. Use direct function references instead.
    @pipe.step("a", to="b")

tests/functional/test_visualization.py::test_branching_graph
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('left') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_visualization.py::test_branching_graph
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('right') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_visualization.py::test_branching_graph
  /home/runner/work/justpipe/justpipe/tests/functional/test_visualization.py:39: DeprecationWarning: String-based topology ('end') is deprecated. Use direct function references instead.
    @pipe.step("left", to="end")

tests/functional/test_visualization.py::test_branching_graph
  /home/runner/work/justpipe/justpipe/tests/functional/test_visualization.py:43: DeprecationWarning: String-based topology ('end') is deprecated. Use direct function references instead.
    @pipe.step("right", to="end")

tests/functional/test_visualization.py::test_complex_dag
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('B') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_visualization.py::test_complex_dag
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('C') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/functional/test_visualization.py::test_complex_dag
  /home/runner/work/justpipe/justpipe/tests/functional/test_visualization.py:116: DeprecationWarning: String-based topology ('D') is deprecated. Use direct function references instead.
    @pipe.step("B", to="D")

tests/functional/test_visualization.py::test_complex_dag
  /home/runner/work/justpipe/justpipe/tests/functional/test_visualization.py:120: DeprecationWarning: String-based topology ('E') is deprecated. Use direct function references instead.
    @pipe.step("C", to="E")

tests/integration/test_acceptance.py::test_etl_pipeline_simulation
  /home/runner/work/justpipe/justpipe/tests/integration/test_acceptance.py:23: DeprecationWarning: String-based topology ('transform') is deprecated. Use direct function references instead.
    @pipe.step("extract", to="transform")

tests/integration/test_acceptance.py::test_etl_pipeline_simulation
  /home/runner/work/justpipe/justpipe/tests/integration/test_acceptance.py:27: DeprecationWarning: String-based topology ('load') is deprecated. Use direct function references instead.
    @pipe.step("transform", to="load")

tests/unit/test_event_hooks.py::test_event_hook_receives_all_event_types
  /home/runner/work/justpipe/justpipe/tests/unit/test_event_hooks.py:105: DeprecationWarning: String-based topology ('second') is deprecated. Use direct function references instead.
    @pipe.step("first", to="second")

tests/unit/test_introspection.py::test_steps_basic
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:15: DeprecationWarning: String-based topology ('second') is deprecated. Use direct function references instead.
    @pipe.step("first", to="second", timeout=5.0, retries=2)

tests/unit/test_introspection.py::test_steps_with_barrier_timeout
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:101: DeprecationWarning: String-based topology ('join') is deprecated. Use direct function references instead.
    @pipe.step("first", to="join")

tests/unit/test_introspection.py::test_steps_with_barrier_timeout
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:105: DeprecationWarning: String-based topology ('join') is deprecated. Use direct function references instead.
    @pipe.step("second", to="join")

tests/unit/test_introspection.py::test_topology_basic
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:126: DeprecationWarning: String-based topology ('second') is deprecated. Use direct function references instead.
    @pipe.step("first", to="second")

tests/unit/test_introspection.py::test_topology_basic
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('third') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/unit/test_introspection.py::test_topology_basic
  /home/runner/work/justpipe/justpipe/justpipe/core.py:665: DeprecationWarning: String-based topology ('fourth') is deprecated. Use direct function references instead.
    self._validate_routing_target(to)

tests/unit/test_introspection.py::test_topology_is_copy
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:153: DeprecationWarning: String-based topology ('second') is deprecated. Use direct function references instead.
    @pipe.step("first", to="second")

tests/unit/test_introspection.py::test_validate_on_run_disabled_by_default
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:173: DeprecationWarning: String-based topology ('nonexistent') is deprecated. Use direct function references instead.
    @pipe.step("first", to="nonexistent")

tests/unit/test_introspection.py::test_validate_on_run_enabled
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:193: DeprecationWarning: String-based topology ('nonexistent') is deprecated. Use direct function references instead.
    @pipe.step("first", to="nonexistent")

tests/unit/test_introspection.py::test_validate_on_run_valid_pipe
  /home/runner/work/justpipe/justpipe/tests/unit/test_introspection.py:211: DeprecationWarning: String-based topology ('second') is deprecated. Use direct function references instead.
    @pipe.step("first", to="second")

tests/unit/test_topology_callable.py::test_pipe_validation_ok
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:121: DeprecationWarning: String-based topology ('step_b') is deprecated. Use direct function references instead.
    @pipe.step(to="step_b")

tests/unit/test_topology_callable.py::test_pipe_validation_broken_ref
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:135: DeprecationWarning: String-based topology ('unknown') is deprecated. Use direct function references instead.
    @pipe.step(to="unknown")

tests/unit/test_topology_callable.py::test_pipe_validation_cycle
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:146: DeprecationWarning: String-based topology ('step_b') is deprecated. Use direct function references instead.
    @pipe.step(to="step_b")

tests/unit/test_topology_callable.py::test_pipe_validation_cycle
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:150: DeprecationWarning: String-based topology ('step_a') is deprecated. Use direct function references instead.
    @pipe.step(to="step_a")

tests/unit/test_topology_callable.py::test_map_on_error_and_to
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:190: DeprecationWarning: String-based topology ('target') is deprecated. Use direct function references instead.
    @pipe.map("mapper", using="target", to="next", on_error=lambda e: None)

tests/unit/test_topology_callable.py::test_map_on_error_and_to
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:190: DeprecationWarning: String-based topology ('next') is deprecated. Use direct function references instead.
    @pipe.map("mapper", using="target", to="next", on_error=lambda e: None)

tests/unit/test_topology_callable.py::test_validate_unreachable_cycle_detached
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:212: DeprecationWarning: String-based topology ('B') is deprecated. Use direct function references instead.
    @pipe.step("A", to="B")

tests/unit/test_topology_callable.py::test_validate_unreachable_cycle_detached
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:216: DeprecationWarning: String-based topology ('A') is deprecated. Use direct function references instead.
    @pipe.step("B", to="A")

tests/unit/test_topology_callable.py::test_validate_unknown_switch_target
  /home/runner/work/justpipe/justpipe/justpipe/core.py:770: DeprecationWarning: String-based topology ('unknown') is deprecated. Use direct function references instead.
    self._validate_routing_target(routes)

tests/unit/test_topology_callable.py::test_validate_unknown_switch_default
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:244: DeprecationWarning: String-based topology ('unknown') is deprecated. Use direct function references instead.
    @pipe.switch("s", routes={}, default="unknown")

tests/unit/test_topology_callable.py::test_validate_unknown_map_target
  /home/runner/work/justpipe/justpipe/tests/unit/test_topology_callable.py:255: DeprecationWarning: String-based topology ('unknown') is deprecated. Use direct function references instead.
    @pipe.map("m", using="unknown")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                 Stmts   Miss  Cover   Missing
------------------------------------------------------------------
justpipe/__init__.py                     3      0   100%
justpipe/core.py                       593     41    93%   46-58, 260, 292, 351, 355, 408-409, 424, 444-446, 461, 723-726, 731-732, 800, 844, 864, 869-870, 907, 942, 962, 976-977, 984-985, 1005, 1007, 1011, 1015
justpipe/types.py                       79      4    95%   18, 24, 49, 52
justpipe/visualization/__init__.py       9      0   100%
justpipe/visualization/ast.py          117      5    96%   135, 160, 170-172
justpipe/visualization/mermaid.py      197     37    81%   96, 104, 141-153, 198-212, 255-273, 295, 308
------------------------------------------------------------------
TOTAL                                  998     87    91%
====================== 176 passed, 62 warnings in 12.31s =======================
